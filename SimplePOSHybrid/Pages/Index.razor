@page "/"
@layout MainLayout
@using SimplePOSHybrid.Data
@using SimplePOSHybrid.Models.PartnerMenu
@using SimplePOSHybrid.Components
@inject IDialogService DialogService

<MudLayout>
    <MudAppBar Style="background-color:#053B71;color:white" Fixed="false" Dense="false" DisableGutters="false" Class="pa-0">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start"  />
        <MudText Class="ml-4" Style="font-weight:800;font-size:large">BLX Super Mart</MudText>
        <MudSpacer />
        <MudIconButton Icon="@Icons.Material.Filled.Logout" Style="color:white" Href="/" />
    </MudAppBar>
        <MudMainContent Class="pa-0">
            <MudContainer Class="pl-0">
                    <MudGrid Class="pt-3">
                        <MudItem xs="5"  Class="pa-0"  >
                            <MudGrid>
                                <MudItem xs="2"></MudItem>
                                <MudItem xs="6" Class="mt-2">
                                    <MudSelect Dense="true" Margin="Margin.Dense" T="string" Label="Order Type" Variant="Variant.Outlined">
                                        <MudSelectItem Value="@("Credit")" />
                                        <MudSelectItem Value="@("Debit")" />
                                    </MudSelect>
                                </MudItem>
                                <MudItem xs="1" Class="mt-2">
                                    <MudIconButton Icon="@Icons.Material.Filled.PersonAddAlt1" OnClick="OpenRegUser" aria-label="add user"></MudIconButton>
                                </MudItem>
                                <MudItem xs="3" Class="mt-2">
                                    <MudIconButton Icon="@Icons.Material.Filled.KeyboardArrowDown" OnClick="OpenExtUsers" aria-label="users"></MudIconButton>
                                </MudItem>
                                <MudItem xs="12">
                                    <MudGrid>
                                        <MudDataGrid Items="@Elements">
                                            <Columns>
                                                <Column T="Menuitemlist" Field="ItemName" Title="Nr" />
                                                
                                               <Column T="Menuitemlist" Title="Qty" />
                                        <Column T="Menuitemlist" Field="ItemShortName" />
                                            </Columns>
                                        </MudDataGrid>
                                   @*
                                        @foreach (var det in orderitems)
                                        {

                                        }*@
                                    </MudGrid>
                                </MudItem>
                            </MudGrid>

                        </MudItem>
                        <MudItem xs="7" Class="pa-0" >
                            <MudTabs Elevation="2" Rounded="true" PanelClass="pa-6" PrevIcon="@Icons.Material.Filled.SkipPrevious" NextIcon="@Icons.Material.Filled.SkipNext"
                                AlwaysShowScrollButtons="true" Color="@Color.Primary" Style="border:thin;border-color:darkgray;border-radius:10px">
                                     @foreach (string category in tabscat)
                                     {
                                        <MudTabPanel Text=@category ToolTip="Choose a Category" OnClick="() => LoadItems(category)" >
                                    
                                            <MudGrid>
                            
                                                @foreach (var item in tabscatitm)
                                                {
                                                    <MudItem xs="3" >
                                                        @if(@item.ItemImageUrl != null)
                                                        {
                                                           <CustomImage Src=@item.ItemImageUrl Name=@item.ItemName ShortName=@item.ItemShortName OnClick="@(() => this.Click(item))" />
                                                        }else
                                                        {
                                                           <CustomImage Src="./Img/no1.jpg" Name=@item.ItemName ShortName=@item.ItemShortName OnClick="@(() => this.Click(item))" />
                                                               
                                                        }
                                                                                              
                                                    </MudItem>
                                                }                            
                                            </MudGrid>   
                                        </MudTabPanel>    
                                      }
                            </MudTabs>
                        </MudItem>
       
                    </MudGrid>
                
            </MudContainer>
        </MudMainContent>
    
     
</MudLayout>


@code{

    public List<string> tabscat = new List<string> { };

    public List<Menuitemlist> tabscatitm = new List<Menuitemlist> { };

    private List<Menuitemlist> orderitems = new List<Menuitemlist> { };

    private IEnumerable<Menuitemlist> Elements = new List<Menuitemlist>();

    public string cate = "chicken 23";

    public ItemModel test;


    public async void Load()
    {
        DashboardView dashboard = new DashboardView();
        test = await dashboard.LoadResponse();

        tabscat = DashboardView.DisplayCat(test);
        tabscatitm = DashboardView.DisplayItem(test,cate);
        Console.WriteLine(tabscatitm);
        StateHasChanged();

    }

    protected override void OnInitialized()
    {
        Load();

    }

    public void LoadItems(string cate)
    {

        tabscatitm = DashboardView.DisplayItem(test,cate);
        StateHasChanged();

    }

    private void OpenExtUsers()
    {
        DialogService.Show<Dialog>("Choose Customer");
    }

    private void OpenRegUser()
    {
        DialogOptions closeOnEscapeKey = new DialogOptions() { CloseOnEscapeKey = true };

        DialogService.Show<RegUser>("Add Customer", closeOnEscapeKey);
    }

    private void Click(Menuitemlist item)
    {
        orderitems.Add(item);
        Elements = orderitems.AsEnumerable();
        Console.WriteLine(Elements);
        StateHasChanged();
    }

    


}