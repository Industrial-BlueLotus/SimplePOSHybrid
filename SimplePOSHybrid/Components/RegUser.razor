@using SimplePOSHybrid.Models.GetCustomer.Create_Update;
@using SimplePOSHybrid.Data;
@using RestSharp;
@inject IDialogService DialogService

<MudDialog Style="background-color:#f2f2f2;border-radius:15px;overflow:unset">
    <DialogContent>
        <MudGrid>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.loyaltyCardNo" Label="No" ></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.name" Label="Customer Name"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.phone" Label="Contact Number"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.email" Label="Email Address"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.doorNo" Label="Door No"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.address" Label="Address Line1"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.city" Label="City"></MudTextField>
            </MudItem>
            <MudItem xs="6">
                <MudTextField T="string" Required="true" @bind-Value="CreateCstmrModel.postalCode" Label="Postal Code"></MudTextField>
            </MudItem>
        </MudGrid>
        
    </DialogContent>
    <DialogActions>
        <MudButton Style="background-color:#053B71;color:white" Variant="Variant.Filled" OnClick="Submit">Add Customer</MudButton>
        <MudButton Style="color:#053B71;border-color:#053B71" OnClick="Cancel" Variant="Variant.Outlined">Clear</MudButton>
        
    </DialogActions>
</MudDialog>
@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    public CreateCstmrModel CreateCstmrModel = new();

    public async Task Submit()
    {
        try
        {
            if ((CreateCstmrModel.name != null || CreateCstmrModel.name != "") && (CreateCstmrModel.address != null || CreateCstmrModel.address != "")
                && (CreateCstmrModel.city != null || CreateCstmrModel.city != "") && (CreateCstmrModel.postalCode != null || CreateCstmrModel.postalCode != "")
                && (CreateCstmrModel.phone != null || CreateCstmrModel.phone != "") && (CreateCstmrModel.loyaltyCardNo != null || CreateCstmrModel.loyaltyCardNo != "")
                && (CreateCstmrModel.email != null || CreateCstmrModel.email != "") && (CreateCstmrModel.doorNo != null || CreateCstmrModel.doorNo != ""))
            {
                RestResponse response1 = await _customer.CreateCustomer(CreateCstmrModel, _loginState.GetToken());
                Console.WriteLine(response1);
                if(response1.IsSuccessful != false)
                {
                    CstmrAdd(response1);
                }
                else
                {
                    CstmrAddfailed();
                }


            }

        }
        catch(Exception ex)
        {
            Console.WriteLine(ex.Message);
        }
        //_customer.CreateCustomer(_loginState.GetToken());
        MudDialog.Close(DialogResult.Ok(true));
    }
    void Cancel() => MudDialog.Cancel();


    private void CstmrAdd(RestResponse response)
    {
        var parameters = new DialogParameters();
        parameters.Add("TitleText", "Success!");
        parameters.Add("ContentText", "Customer Added Successfully.");
        parameters.Add("ButtonText", "Close");

        DialogService.Show<CstmrAddCnfrm>("Choose PrevSale", parameters);

    }

    private void CstmrAddfailed()
    {
        var parameters = new DialogParameters();
        parameters.Add("TitleText", "UnSuccessfull!");
        parameters.Add("ContentText", "Try again.");
        parameters.Add("ButtonText", "Close");

        DialogService.Show<CstmrAddCnfrm>("Choose PrevSale", parameters);

    }
}